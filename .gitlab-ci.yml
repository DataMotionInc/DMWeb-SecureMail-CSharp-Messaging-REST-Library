#image: fela98/mono-nunit
#image: didstopia/msbuild
#image: dmirmilshteyn/dotnet-msbuild-mono
image: alexellisio/msbuild:12.0

before_script:
  - nuget restore -NonInteractive

stages:
  - build

build:
  stage: build
  script:
    #Build DLLs
    - msbuild Build.proj /p:Configuration=Debug /p:Platform="Any CPU" /p:build_number=1.0.0.20
    - cat CommonAssemblyInfo2.cs
    #Write Config File from Environment Variables
    - echo "UserIdOrEmail:"$UserIdOrEmail > "Consolidated Unit Tests/bin/Debug/Test Documents/MessageData.txt"
    - echo "Password:"$Password >> "Consolidated Unit Tests/bin/Debug/Test Documents/MessageData.txt"
    - echo "ToAddress:"$ToAddress >> "Consolidated Unit Tests/bin/Debug/Test Documents/MessageData.txt"
    - echo "FromAddress:"$FromAddress >> "Consolidated Unit Tests/bin/Debug/Test Documents/MessageData.txt"
    - cat "Consolidated Unit Tests/bin/Debug/Test Documents/MessageData.txt"
    #Change directory and run unit tests
    - cd "Consolidated Unit Tests/bin/Debug"
    - nunit "Consolidated Unit Tests.dll"
    #Build DLLs in Release mode
    - cd ../../../
    - msbuild Build.proj /p:Configuration=Release /p:Platform="Any CPU" /p:build_number=1.0.0.20
    - cat CommonAssemblyInfo2.cs
  artifacts:
    paths:
      - "Consolidated Unit Tests/bin/Debug/TestResult.xml"
      - "Messaging Library/bin/Release/Messaging Library.dll"